package com.ftn.sbnz.rules.cep;

import com.ftn.sbnz.model.events.RoadStatusEvent;
import com.ftn.sbnz.model.enums.RoadStatus;
import com.ftn.sbnz.model.dtos.travelPlan.TravelPlanResponse;
import com.ftn.sbnz.model.dtos.ItineraryItem;

declare RoadStatusEvent
    @role(event)
    @timestamp(timestamp) // Kažemo Drools-u koje polje je vremenska oznaka
end

// Pravilo reaguje na događaj zatvaranja puta i proverava da li utiče na neki od planova u memoriji
rule "React to Vrsic Pass Closure on existing plans"
    when
        // Uslov 1: Stigao je događaj da je prelaz Vršič ZATVOREN
        $event: RoadStatusEvent(roadName == "Vršič", status == RoadStatus.CLOSED)

        // Uslov 2: U memoriji postoji plan putovanja...
        $plan: TravelPlanResponse($itinerary: itinerary)

        // Uslov 3: ...koji u svom itinereru sadrži lokaciju koja zavisi od Vršiča
        exists ItineraryItem(location.name == "Triglavski narodni park" || location.name == "Kranjska Gora") from $itinerary
    then
        // Akcija: Za sada, samo ispisujemo kritično upozorenje u konzoli
        // U realnoj aplikaciji, ovde bi se dodao Alert u bazu ili poslala notifikacija
        System.out.println("====== KRITIČNO UPOZORENJE (CEP) ======");
        System.out.println("! Putni prelaz Vršič je upravo ZATVOREN !");
        System.out.println("! Ovo utiče na generisani plan putovanja !");
        System.out.println("=========================================");
end